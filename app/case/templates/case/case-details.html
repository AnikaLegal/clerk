{% extends "case/_base.html" %}
{% block title %}Case {{ issue.fileref }}{% endblock %}

{% block scripts%}
<script>
    // Initialize JavaScript enabled Semantic UI elements.
    $('.selection.dropdown').dropdown()
    $('.menu .item').tab()
</script>
{% endblock %}


{% block content %}
<div class="ui container">
    <h1 class="ui header">
        {{ issue.topic|title }} case for {{ issue.client.get_full_name|title }} ({{ issue.fileref }})
        <div class="sub header">
            Created {{ issue.created_at|date:"jS M 'y" }}, updated {{ issue.modified_at|date:"jS M 'y" }}
            (<a href="{{actionstep_url}}">view in Actionstep</a>)
        </div>
    </h1>
    <div class="ui top attached tabular menu">
        <a class="item active" data-tab="details">            
            <i class="clipboard list icon"></i>
            Details
        </a>
        <a class="item" data-tab="progress">
            <i class="chart line icon"></i>
            Progress
        </a>
    </div>
    {# Details Tab #}
    <div class="ui bottom attached tab segment active" data-tab="details">
        <div class="ui two column grid">

            {# Client card #}
            <div class="column">
                <div class="ui card fluid">
                    <div class="content">
                        <div class="header">{{ issue.client.get_full_name|title }} (Client)</div>
                        <div class="meta">
                            <span>Created {{ issue.client.created_at|date:"jS M 'y" }}, updated {{ issue.client.modified_at|date:"jS M 'y" }}</span>
                        </div>
                        <table class="ui definition table">
                            <tbody>
                                <tr>
                                    <td>Email</td>
                                    <td>{{ issue.client.email }}</td>
                                </tr>
                                <tr>
                                    <td>Phone</td>
                                    <td>{{ issue.client.phone_number }} (call {{ issue.client.call_times|join:', '|lower }})</td>
                                </tr>
                                <tr>
                                    <td>Age</td>
                                    <td>{{ issue.client.get_age }} years old</td>
                                </tr>
                                <tr>
                                    <td>Gender</td>
                                    <td>{{ issue.client.gender|title }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            {# Tenancy card #}
            <div class="column">
                <div class="ui card fluid">
                    <div class="content">
                        <div class="header">Tenancy</div>
                        <div class="meta">
                            <span>Created {{ tenancy.created_at|date:"jS M 'y" }}, updated {{ tenancy.modified_at|date:"jS M 'y" }}</span>
                        </div>

                        <table class="ui definition table">
                            <tbody>
                                <tr>
                                    <td>Street Address</td>
                                    <td>{{tenancy.address}}</td>
                                </tr>
                                <tr>
                                    <td>Suburb</td>
                                    <td>{{tenancy.suburb}} {{tenancy.postcode}}</td>
                                </tr>
                                <tr>
                                    <td>Started</td>
                                    <td>{{ tenancy.started|date:"jS M 'y" }}</td>
                                </tr>
                                <tr>
                                    <td>Client on lease</td>
                                    <td>{{ tenancy.is_on_lease|title }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            {# Landord card #}
            {% if tenancy.landlord %}
                <div class="column">
                    <div class="ui card fluid">
                        <div class="content">
                            <div class="header">Landlord</div>
                            <div class="meta">
                                <span>Created {{ tenancy.landlord.created_at|date:"jS M 'y" }}, updated {{ tenancy.landlord.modified_at|date:"jS M 'y" }}</span>
                            </div>

                            <table class="ui definition table">
                                <tbody>
                                    <tr>
                                        <td>Name</td>
                                        <td>{{ tenancy.landlord.full_name|default:"-" }}</td>
                                    </tr>
                                    <tr>
                                        <td>Address</td>
                                        <td>{{ tenancy.landlord.address|default:"-" }}</td>
                                    </tr>
                                    <tr>
                                        <td>Email</td>
                                        <td>{{  tenancy.landlord.email|default:"-"  }}</td>
                                    </tr>
                                    <tr>
                                        <td>Phone</td>
                                        <td>{{  tenancy.landlord.phone|default:"-"  }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            {% endif %}


            {# Real estate agent card #}
            {% if tenancy.agent %}
                <div class="column">
                    <div class="ui card fluid">
                        <div class="content">
                            <div class="header">Real estate agent</div>
                            <div class="meta">
                                <span>Created {{ tenancy.agent.created_at|date:"jS M 'y" }}, updated {{ tenancy.agent.modified_at|date:"jS M 'y" }}</span>
                            </div>

                            <table class="ui definition table">
                                <tbody>
                                    <tr>
                                        <td>Name</td>
                                        <td>{{ tenancy.agent.full_name|default:"-" }}</td>
                                    </tr>
                                    <tr>
                                        <td>Address</td>
                                        <td>{{ tenancy.agent.address|default:"-" }}</td>
                                    </tr>
                                    <tr>
                                        <td>Email</td>
                                        <td>{{  tenancy.agent.email|default:"-"  }}</td>
                                    </tr>
                                    <tr>
                                        <td>Phone</td>
                                        <td>{{  tenancy.agent.phone|default:"-"  }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
        <div class="ui card fluid">
            <div class="content">
                <div class="header">Other submitted data</div>
                <div class="meta">
                    <span>This will be more nicely formatted later on.</span>
                </div>
                <table class="ui definition table">
                    <tbody>
                        {% for k, v in issue.answers.items %}
                        <tr>
                            <td>{{ k }}</td>
                            <td>{{ v|default:"-" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        {% comment %}      
            TODO - Uploaded Images and files 
            <h2 class="ui horizontal divider header">
                <i class="image icon"></i>
                Images
            </h2>
        {% endcomment %}
    </div>
    {# Progress Tab #}
    <div class="ui bottom attached tab segment" data-tab="progress">
        <form class="ui form">
            <div class="two fields">
                <div class="field">
                    <label>Stage</label>
                    <div class="ui selection dropdown" tabindex="0">
                        <input type="hidden" name="stage" class="noselection">
                        <i class="dropdown icon"></i>
                        <div class="default text">Select a stage</div>
                        <div class="menu transition hidden" tabindex="-1">
                            {# TODO: Add information and populate from view #}
                            <div class="item" data-value="SUBMITTED">Submitted</div>
                            <div class="item" data-value="ENGAGED">Engaged</div>
                            <div class="item" data-value="ADVICE">Advice</div>
                            <div class="item" data-value="POST_CASE">Post case</div>
                        </div>
                    </div>
                </div>
                <div class="field">
                    <label>Outcome</label>
                    <div class="ui selection dropdown" tabindex="0">
                        <input type="hidden" name="outcome" class="noselection">
                        <i class="dropdown icon"></i>
                        <div class="default text">Select an outcome</div>
                        <div class="menu transition hidden" tabindex="-1">
                            {# TODO: Add information and populate from view #}
                            <div class="item" data-value="">-</div>
                            <div class="item" data-value="UNKNOWN">Unknown</div>
                            <div class="item" data-value="UNRESPONSIVE">Unresponsive</div>
                            <div class="item" data-value="OUT_OF_SCOPE">Out of scope</div>
                            <div class="item" data-value="SUCCESS">Success</div>
                            <div class="item" data-value="UNSUCCESSFUL">Unsuccessful</div>
                            <div class="item" data-value="REFERRED">Referred</div>
                            <div class="item" data-value="ESCALATION">Escalation</div>
                            <div class="item" data-value="DROPPED_OUT">Dropped out</div>
                            <div class="item" data-value="RESOLVED_EARLY">Resolved early</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="two fields">
                <div class="field">
                    <div class="ui checkbox">
                        <input id="case-open" {% if issue.is_open %}checked{% endif %}  type="checkbox" class="hidden">
                        <label for="case-open">Case Open</label>
                    </div>
                </div>
                <div class="field">
                    <div class="ui checkbox">
                        <input id="legal-services" {% if issue.provided_legal_services %}checked{% endif %}  type="checkbox" class="hidden">
                        <label for="legal-services">Legal Services Provided</label>
                    </div>
                </div>
            </div>
            <div class="field">
                <label>Outcome Notes</label>
                <textarea></textarea>
            </div>
            <button class="ui button" type="submit">Update</button>
        </form>
    </div>
    
    {% comment %} TODO: Make editable
    - case open
    - legal advice
    - latest stage
    - outcome
    - outcome notes
    {% endcomment %}

</div>
{% endblock %}

